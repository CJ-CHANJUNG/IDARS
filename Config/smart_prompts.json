{
    "_metadata": {
        "version": "1.0.0",
        "last_updated": "2026-01-08",
        "engine": "SmartExtractionEngine",
        "description": "ì´ íŒŒì¼ì€ Smart Extraction Engine(BL, Invoice ì¶”ì¶œ)ì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  í”„ë¡¬í”„íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.",
        "usage_note": "ì´ íŒŒì¼ì„ ìˆ˜ì •í•˜ë©´ ë‹¤ìŒ ì¶”ì¶œë¶€í„° ìƒˆ í”„ë¡¬í”„íŠ¸ê°€ ì ìš©ë©ë‹ˆë‹¤. ë°±ì—”ë“œ ì¬ì‹œì‘ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    },
    "system_instruction": {
        "description": "Gemini ëª¨ë¸ ì´ˆê¸°í™” ì‹œ ì„¤ì •ë˜ëŠ” ì‹œìŠ¤í…œ ì „ì—­ ì§€ì‹œì‚¬í•­ì…ë‹ˆë‹¤. ëª¨ë“  API í˜¸ì¶œì— ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.",
        "usage": "SmartExtractionEngine.__init__() -> _load_configs() -> genai.GenerativeModel(system_instruction=...)",
        "llm_delivery": "ëª¨ë“  Gemini API í˜¸ì¶œ ì‹œ ìë™ìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ì— í¬í•¨ë¨ (ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ì—†ëŠ” ë°±ê·¸ë¼ìš´ë“œ ì§€ì‹œì‚¬í•­)",
        "editable": true,
        "content": "ë¬¼ë¥˜ ë¬¸ì„œ(B/L, Invoice) ë°ì´í„° ì¶”ì¶œ ì—”ì§„. JSON ì‘ë‹µ í•„ìˆ˜. ë‚ ì§œëŠ” YYYY-MM-DD, í†µí™” ì½”ë“œ ì¤€ìˆ˜, ìˆ˜ëŸ‰/ê¸ˆì•¡ì€ ìˆ«ì(ì‰¼í‘œ ì œê±°)."
    },
    "doc_type_instructions": {
        "description": "ë¬¸ì„œ íƒ€ì…ë³„ ì¶”ê°€ ì§€ì‹œì‚¬í•­ì…ë‹ˆë‹¤. ë©”ì¸ í”„ë¡¬í”„íŠ¸ì— {doc_instruction} ë³€ìˆ˜ë¡œ ì‚½ì…ë©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ doc_typeì— ë”°ë¼ ì„ íƒë¨ (Line 272-275)",
        "llm_delivery": "ë©”ì¸ í”„ë¡¬í”„íŠ¸ì˜ ìƒë‹¨ì— ì‚½ì…ë˜ì–´ LLMì— ì „ë‹¬ë¨ (ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ì˜ ì¼ë¶€)",
        "editable": true,
        "BL": {
            "doc_type": "Bill of Lading (ì„ í•˜ì¦ê¶Œ)",
            "content": "ì„ í•˜ì¦ê¶Œ(B/L). ì„ ë°•/ìš´ì†¡ ì •ë³´, Incoterms, ì¤‘ëŸ‰(Net/Gross Weight) ì¶”ì¶œ."
        },
        "INVOICE": {
            "doc_type": "Commercial Invoice (ìƒì—…ì†¡ì¥)",
            "content": "ìƒì—…ì†¡ì¥. ê¸ˆì•¡/ê±°ë˜ ì •ë³´ ì¤‘ì‹¬ ì¶”ì¶œ."
        }
    },
    "hint_instruction_template": {
        "description": "ê¸°ëŒ€ ê°’(Expected Values)ì´ ìˆì„ ë•Œ LLMì—ê²Œ íŒíŠ¸ë¥¼ ì£¼ëŠ” í”„ë¡¬í”„íŠ¸ì…ë‹ˆë‹¤. SAP ë°ì´í„°ì™€ ë¹„êµí•  ê¸ˆì•¡/ìˆ˜ëŸ‰ì´ ìˆì„ ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì—ì„œ expected_values íŒŒë¼ë¯¸í„°ê°€ ìˆì„ ë•Œ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ (Line 278-288)",
        "llm_delivery": "ë©”ì¸ í”„ë¡¬í”„íŠ¸ì˜ {hint_instruction} ìœ„ì¹˜ì— ì‚½ì…ë¨. total_amount, total_quantity ê°’ì´ ë™ì ìœ¼ë¡œ ì¹˜í™˜ë©ë‹ˆë‹¤.",
        "editable": true,
        "variables": [
            "total_amount",
            "total_quantity"
        ],
        "content": "\n**[íŒíŠ¸]** ê¸°ëŒ€ê°’:\n- ì´ ê¸ˆì•¡: {total_amount}\n- ì´ ìˆ˜ëŸ‰: {total_quantity}\nê¸°ëŒ€ê°’ê³¼ ë‹¤ë¥´ë©´ ë¬¸ì„œê°’ ì¶”ì¶œ í›„ 'notes'ì— ì´ìœ  ê¸°ë¡.\n"
    },
    "field_prompt_hints": {
        "description": "íŠ¹ì • í•„ë“œì— ëŒ€í•œ ì¶”ê°€ íŒíŠ¸ì…ë‹ˆë‹¤. í•„ë“œë³„ í”„ë¡¬í”„íŠ¸ ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì—ì„œ extraction_fieldsë¥¼ ìˆœíšŒí•˜ë©° í•„ë“œëª…ì— 'incoterms'ê°€ í¬í•¨ë˜ë©´ íŒíŠ¸ ì¶”ê°€ (Line 298-299)",
        "llm_delivery": "ë©”ì¸ í”„ë¡¬í”„íŠ¸ì˜ 'ì¶”ì¶œí•  í•„ë“œ' ì„¹ì…˜ì— ê° í•„ë“œ ì„¤ëª… ë’¤ì— ì¶”ê°€ë¨",
        "editable": true,
        "incoterms": " (ì˜ˆ: FOB, CIF, EXW, DDP ë“±)"
    },
    "main_extraction_prompt": {
        "description": "ì‹¤ì œ ë°ì´í„° ì¶”ì¶œì„ ìˆ˜í–‰í•˜ëŠ” ë©”ì¸ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì…ë‹ˆë‹¤. ëª¨ë“  ë³€ìˆ˜ê°€ ì¹˜í™˜ëœ í›„ LLMì— ì „ë‹¬ë©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì—ì„œ ì¡°ë¦½ë¨ (Line 351-379)",
        "llm_delivery": "ì´ í…œí”Œë¦¿ì˜ ëª¨ë“  ë³€ìˆ˜ê°€ ì‹¤ì œ ê°’ìœ¼ë¡œ ì¹˜í™˜ëœ í›„ Gemini APIì— ì „ë‹¬ë¨. ì´ê²ƒì´ LLMì´ ë³´ëŠ” ìµœì¢… í”„ë¡¬í”„íŠ¸ì…ë‹ˆë‹¤.",
        "variables": {
            "doc_type": "ë¬¸ì„œ íƒ€ì… (BL ë˜ëŠ” INVOICE)",
            "doc_instruction": "doc_type_instructionsì—ì„œ ì„ íƒëœ ì§€ì‹œì‚¬í•­",
            "hint_instruction": "expected_valuesê°€ ìˆìœ¼ë©´ hint_instruction_template, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´",
            "ocr_text": "PDFì—ì„œ ì¶”ì¶œí•œ ì‹¤ì œ í…ìŠ¤íŠ¸ (ìµœëŒ€ 3í˜ì´ì§€)",
            "field_prompts": "extraction_config.jsonì˜ í•„ë“œ ì •ì˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì  ìƒì„±ëœ í•„ë“œ ëª©ë¡",
            "response_format": "ê¸°ëŒ€í•˜ëŠ” JSON ì‘ë‹µ í˜•ì‹ (expected_fields_example ê¸°ë°˜)"
        },
        "editable": true,
        "content": "\n{doc_type} ë¬¸ì„œ OCR ë¶„ì„:\n\n{doc_instruction}\n{hint_instruction}\n\n{ocr_text}\n\n**ì¶”ì¶œ í•„ë“œ:**\n{field_prompts}\n\n**JSON ì‘ë‹µ:**\n{{\n  \"document_type\": \"{doc_type}\",\n  \"confidence\": 0.95,\n  \"fields\": {response_format},\n  \"field_confidence\": {{[í•„ë“œë³„ ì‹ ë¢°ë„ 0.0~1.0]}},\n  \"evidence\": [{{\"field\": \"total_amount\", \"values\": [100.00, 200.00], \"coordinates\": [[ymin,xmin,ymax,xmax]], \"reason\": \"í•©ê³„ ì¼ì¹˜\"}}],\n  \"notes\": \"íŠ¹ì´ì‚¬í•­/ë¶ˆí™•ì‹¤ ë¶€ë¶„\"\n}}\n"
    },
    "n1_matching_retry_prompt": {
        "description": "N:1 ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„í•  ë•Œ ì¶”ê°€ë˜ëŠ” í”„ë¡¬í”„íŠ¸ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ë¼ì¸ ì•„ì´í…œì˜ í•©ê³„ê°€ ê¸°ëŒ€ê°’ê³¼ ì¼ì¹˜í•´ì•¼ í•˜ëŠ” ê²½ìš° ì‚¬ìš©ë©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì—ì„œ ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë©”ì¸ í”„ë¡¬í”„íŠ¸ ë’¤ì— ì¶”ê°€ë¨ (Line 466-471)",
        "llm_delivery": "ê¸°ì¡´ ë©”ì¸ í”„ë¡¬í”„íŠ¸ ë’¤ì— ì´ ë‚´ìš©ì´ ì¶”ê°€ë˜ì–´ ì¬ì‹œë„ API í˜¸ì¶œ ì‹œ ì „ë‹¬ë¨. LLMì—ê²Œ 'ì´ì „ ì‹œë„ê°€ ì‹¤íŒ¨í–ˆìœ¼ë‹ˆ ì´ë ‡ê²Œ í•´ë¼'ëŠ” ì¶”ê°€ ì§€ì‹œì‚¬í•­ì…ë‹ˆë‹¤.",
        "trigger_condition": "ì¶”ì¶œëœ total_amount ë˜ëŠ” total_quantityê°€ expected_valuesì™€ ë‹¤ë¥¼ ë•Œ (is_valid = False)",
        "variables": [
            "exp_amount"
        ],
        "editable": true,
        "content": "\n**í•„ìˆ˜:**\n- `total_amount`ëŠ” í•©ê³„ê°’({exp_amount})ìœ¼ë¡œ ì„¤ì •, ë¬¸ì„œ ì´ì•¡ ì•„ë‹˜.\n- 'evidence'ì— ì¡°í•© ì„¤ëª…: \"í•­ëª©1(100.00)+í•­ëª©3(200.00)={exp_amount}\".\n- 'notes'ì— \"N:1 ì¡°í•©\" ëª…ì‹œ.\n"
    },
    "preprocessing_config": {
        "description": "í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬ ê´€ë ¨ ì„¤ì •ì…ë‹ˆë‹¤. OCR í…ìŠ¤íŠ¸ë¥¼ LLMì— ì „ë‹¬í•˜ê¸° ì „ì— ì •ë¦¬í•˜ëŠ” ê³¼ì •ì„ ì œì–´í•©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì—ì„œ text_preprocessor í˜¸ì¶œ ì „ (Line 314-317)",
        "llm_delivery": "LLMì— ì§ì ‘ ì „ë‹¬ë˜ì§€ ì•ŠìŒ. OCR í…ìŠ¤íŠ¸ë¥¼ ì •ë¦¬í•˜ëŠ” ì „ì²˜ë¦¬ ë‹¨ê³„ì—ì„œë§Œ ì‚¬ìš©ë¨.",
        "editable": true,
        "enabled": true,
        "log_message": "ğŸ§¹ Preprocessing text... (Original: {original_length} chars)\nâœ¨ Preprocessed: {processed_length} chars"
    },
    "combination_finder_config": {
        "description": "N:1 ì¡°í•© ì°¾ê¸° ë¡œì§ ì„¤ì •ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ê¸ˆì•¡/ìˆ˜ëŸ‰ì˜ í•©ì´ ê¸°ëŒ€ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ì¡°í•©ì„ Pythonìœ¼ë¡œ ë¯¸ë¦¬ ì°¾ì•„ LLMì—ê²Œ íŒíŠ¸ë¥¼ ì¤ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì—ì„œ expected_valuesê°€ ìˆê³  combination_finderê°€ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œ (Line 321-349)",
        "llm_delivery": "ì¡°í•©ì„ ì°¾ìœ¼ë©´ hint_instructionì— 'ğŸ’¡ Found combination for Amount: ...' í˜•íƒœë¡œ ì¶”ê°€ë˜ì–´ LLMì— ì „ë‹¬ë¨",
        "editable": true,
        "enabled": true,
        "hint_template": "- ğŸ’¡ Found combination for {field_type}: {combination} = {target}\n",
        "hint_suffix": "\n**[N:1 MATCHING HINTS]**\n{combo_hint}Use these combinations to verify the total amount/quantity. If they match, extract the individual items as evidence.\n"
    },
    "retry_config": {
        "description": "API ì¬ì‹œë„ ì„¤ì •ì…ë‹ˆë‹¤. Gemini API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ íšŸìˆ˜ì™€ ëŒ€ê¸° ì‹œê°„ì„ ì œì–´í•©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì˜ ì¬ì‹œë„ ë£¨í”„ (Line 383-512)",
        "llm_delivery": "LLMì— ì§ì ‘ ì „ë‹¬ë˜ì§€ ì•ŠìŒ. API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§ì—ì„œë§Œ ì‚¬ìš©ë¨.",
        "editable": true,
        "max_retries": 1,
        "retry_delay_seconds": 2,
        "exponential_backoff": true,
        "quota_exceeded_wait_seconds": 60
    },
    "validation_config": {
        "description": "ì¶”ì¶œ ê²°ê³¼ ê²€ì¦ ì„¤ì •ì…ë‹ˆë‹¤. LLM ì‘ë‹µì´ ìœ íš¨í•œì§€ í™•ì¸í•˜ëŠ” ê·œì¹™ì„ ì •ì˜í•©ë‹ˆë‹¤.",
        "usage": "extract_with_gemini_async() í•¨ìˆ˜ì˜ ê²€ì¦ ë¡œì§ (Line 424-482)",
        "llm_delivery": "LLMì— ì§ì ‘ ì „ë‹¬ë˜ì§€ ì•ŠìŒ. LLM ì‘ë‹µì„ ë°›ì€ í›„ ê²€ì¦ ë‹¨ê³„ì—ì„œë§Œ ì‚¬ìš©ë¨.",
        "editable": true,
        "critical_fields": {
            "INVOICE": [
                "total_amount"
            ],
            "BL": [
                "bl_number"
            ]
        },
        "min_text_length_for_validation": 50
    }
}