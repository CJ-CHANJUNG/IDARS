<!DOCTYPE html>
<html>

<head>
    <title>IDARS Backend Test</title>
</head>

<body>
    <h1>IDARS Backend Upload Test</h1>

    <div>
        <h2>1. Create Project</h2>
        <input type="text" id="projectName" value="Test Project" />
        <button onclick="createProject()">Create Project</button>
        <div id="projectResult"></div>
    </div>

    <div style="margin-top: 20px;">
        <h2>2. Upload CSV</h2>
        <input type="file" id="fileInput" accept=".csv" />
        <button onclick="uploadFile()">Upload</button>
        <div id="uploadResult"></div>
    </div>

    <div style="margin-top: 20px;">
        <h2>3. SAP Download</h2>
        <input type="date" id="dateFrom" value="2025-11-01" />
        <input type="date" id="dateTo" value="2025-11-30" />
        <button onclick="sapDownload()">Download SAP</button>
        <div id="sapResult"></div>
    </div>

    <script>
        let currentProject = null;

        async function createProject() {
            const name = document.getElementById('projectName').value;
            const response = await fetch('http://127.0.0.1:5000/api/projects', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name })
            });
            const result = await response.json();
            currentProject = result;
            document.getElementById('projectResult').innerHTML =
                `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            console.log('Project created:', result);
        }

        async function uploadFile() {
            if (!currentProject) {
                alert('Create a project first!');
                return;
            }

            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files[0]) {
                alert('Select a file first!');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('projectId', currentProject.id);

            console.log('Uploading file:', fileInput.files[0].name);
            const response = await fetch('http://127.0.0.1:5000/api/upload', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            document.getElementById('uploadResult').innerHTML =
                `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            console.log('Upload result:', result);
        }

        async function sapDownload() {
            if (!currentProject) {
                alert('Create a project first!');
                return;
            }

            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;

            console.log('SAP download:', dateFrom, dateTo);
            const response = await fetch('http://127.0.0.1:5000/api/sap/download', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    projectId: currentProject.id,
                    dateFrom: dateFrom,
                    dateTo: dateTo
                })
            });
            const result = await response.json();
            document.getElementById('sapResult').innerHTML =
                `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            console.log('SAP result:', result);
        }
    </script>
</body>

</html>